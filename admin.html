<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Panel de Administración</title>
</head>

<body>
  <h2>Crear nuevo formulario</h2>
  <form id="crearFormulario">
    <label>ID del formulario (ej. flores):</label><br>
    <input type="text" id="formId" required><br><br>
    <label>Título:</label><br>
    <input type="text" id="titulo" required><br><br>
    <!-- Campo oculto: se llena automáticamente con la fecha de hoy -->
    <input type="hidden" id="fechaCierre">
    <button type="submit">Crear Formulario</button>
  </form>
  <p id="mensaje"></p>

  <script>
    const baseURL = location.origin;

    document.getElementById("crearFormulario").addEventListener("submit", function (e) {
      e.preventDefault();

      const id = document.getElementById("formId").value.trim();
      const titulo = document.getElementById("titulo").value.trim();
       // Calcular la hora de caducidad: ahora + 1 hora
       const ahora = new Date();
      const fechaCierre = new Date(ahora.getTime() + 60 * 60 * 1000).toISOString(); // +1 hora en ISO

      document.getElementById("fechaCierre").value = fechaCierre;

      fetch("/api/guardarFormulario", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id, titulo, fechaCierre: fechaCierre })
      })
        .then(res => {
          if (!res.ok) throw new Error("No se pudo guardar");
          const enlace = `${baseURL}/formulario.html?id=${encodeURIComponent(id)}`;
          document.getElementById("mensaje").innerHTML = `
    ✅ Formulario creado con éxito.<br>
    👉 <a href="${enlace}" target="_blank">${enlace}</a>
    <br><button onclick="navigator.clipboard.writeText('${enlace}')">📋 Copiar enlace</button>
  `;
        })
        .catch(err => {
          console.error(err);
          document.getElementById("mensaje").textContent = "❌ Error al guardar.";
        });

    });
  </script>
</body>

</html>