<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de AdministraciÃ³n</title>
</head>
<body>
  <h2>Crear nuevo formulario</h2>
  <form id="crearFormulario">
    <label>ID del formulario (ej. flores):</label><br>
    <input type="text" id="formId" required><br><br>
    <label>TÃ­tulo:</label><br>
    <input type="text" id="titulo" required><br><br>
    <!-- Ocultamos el campo de fecha porque se generarÃ¡ automÃ¡ticamente -->
<input type="hidden" id="fechaCierre">

    <button type="submit">Crear Formulario</button>
  </form>
  <p id="mensaje"></p>

  <script>
    const baseURL = location.origin; // toma el dominio actual (ej. https://tusitio.vercel.app)
  
    document.getElementById("crearFormulario").addEventListener("submit", function(e) {
      e.preventDefault();
      const id = document.getElementById("formId").value.trim();
      const titulo = document.getElementById("titulo").value.trim();

      const fecha = new Date().toISOString().split("T")[0]; // YYYY-MM-DD
document.getElementById("fechaCierre").value = fecha;

  
      fetch("data/formularios.json")
        .then(res => res.json())
        .then(data => {
          data[id] = { titulo, fechaCierre: fecha };
          return fetch("data/formularios.json", {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data, null, 2)
          });
        })
        .then(() => {
          const enlace = `${baseURL}/formulario.html?id=${encodeURIComponent(id)}`;
          document.getElementById("mensaje").innerHTML = `
            âœ… Formulario creado con Ã©xito.<br>
            ğŸ‘‰ <a href="${enlace}" target="_blank">${enlace}</a>
            <br><button onclick="navigator.clipboard.writeText('${enlace}')">ğŸ“‹ Copiar enlace</button>
          `;
        })
        .catch(err => {
          console.error(err);
          document.getElementById("mensaje").textContent = "âŒ Error al guardar.";
        });
    });
  </script>
  
</body>
</html>